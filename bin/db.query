#!/usr/bin/env python3
import duckdb, sys, json

if len(sys.argv) > 1:
    sql = sys.argv[1]
else:
    sql = "SELECT run_id,ticker,signal,ROUND(rsi14,2) rsi,ROUND(atr_pct,2) atr FROM signals ORDER BY run_id DESC, ticker LIMIT 10;"

con = duckdb.connect("data/stock_signals.duckdb", read_only=True)
cols = [c[0] for c in con.execute(sql).description]
rows = [dict(zip(cols, r)) for r in con.fetchall()]
print(json.dumps(rows, ensure_ascii=False, indent=2))
con.close()
