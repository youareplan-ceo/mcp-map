<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StockPilot AI - AI 자산관리 파트너</title>
    <style>
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
        }
        
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
            background: #0a0e27; 
            color: #ffffff; 
            min-height: 100vh;
            padding-bottom: 80px;
        }
        
        /* 헤더 */
        .header { 
            padding: 20px;
            background: rgba(255,255,255,0.03);
            border-bottom: 1px solid rgba(255,255,255,0.08);
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
        }
        
        .header h1 { 
            font-size: 24px; 
            font-weight: 700;
            background: linear-gradient(90deg, #00d4ff, #0099ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        /* 페이지 컨테이너 */
        .page {
            display: none;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .page.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* 포트폴리오 카드 */
        .portfolio-card { 
            background: linear-gradient(135deg, rgba(0,150,255,0.15), rgba(0,200,255,0.08));
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 25px;
            border: 1px solid rgba(0,150,255,0.2);
        }
        
        .portfolio-label {
            font-size: 14px;
            color: #8B95A1;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .portfolio-value { 
            font-size: 42px;
            font-weight: 700;
            margin-bottom: 12px;
            letter-spacing: -1px;
        }
        
        .profit-info {
            display: flex;
            align-items: baseline;
            gap: 12px;
        }
        
        .positive { color: #00ff88; }
        .negative { color: #ff4757; }
        
        /* 상태 카드 */
        .status-card {
            background: rgba(255,255,255,0.05);
            border-radius: 16px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 25px;
            border: 1px solid rgba(255,255,255,0.08);
        }
        
        .status-icon {
            font-size: 24px;
        }
        
        .status-text {
            font-size: 18px;
            font-weight: 600;
        }
        
        /* AI 추천 카드 */
        .action-grid { 
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .action-card { 
            background: rgba(255,255,255,0.04);
            border-radius: 16px;
            padding: 24px;
            border: 1px solid rgba(255,255,255,0.08);
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .action-card:hover { 
            transform: translateY(-2px);
            background: rgba(255,255,255,0.06);
        }
        
        .action-card.danger { 
            border-left: 3px solid #ff4757;
            background: linear-gradient(90deg, rgba(255,71,87,0.1), transparent);
        }
        
        .action-card.opportunity { 
            border-left: 3px solid #00ff88;
            background: linear-gradient(90deg, rgba(0,255,136,0.1), transparent);
        }
        
        .action-title { 
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .detail-box { 
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
            font-size: 15px;
            line-height: 1.6;
        }
        
        .detail-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        
        .detail-row:last-child {
            margin-bottom: 0;
        }
        
        .detail-label {
            color: #8B95A1;
        }
        
        .detail-value {
            font-weight: 600;
        }
        
        /* 액션 버튼 */
        .action-button { 
            width: 100%;
            padding: 14px;
            background: linear-gradient(90deg, #0099ff, #00d4ff);
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .action-button:active {
            transform: scale(0.98);
        }
        
        /* 종목 리스트 */
        .stock-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .stock-card {
            background: rgba(255,255,255,0.04);
            border-radius: 16px;
            padding: 20px;
            border: 1px solid rgba(255,255,255,0.08);
            transition: all 0.2s;
        }
        
        .stock-card:hover {
            background: rgba(255,255,255,0.06);
        }
        
        .stock-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 12px;
        }
        
        .stock-name {
            font-size: 18px;
            font-weight: 600;
        }
        
        .stock-quantity {
            font-size: 14px;
            color: #8B95A1;
        }
        
        .stock-current {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 8px;
        }
        
        .stock-profit {
            display: flex;
            justify-content: space-between;
            font-size: 14px;
        }
        
        /* 거래 기록 */
        .history-item {
            background: rgba(255,255,255,0.04);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            border: 1px solid rgba(255,255,255,0.08);
        }
        
        .history-date {
            font-size: 12px;
            color: #8B95A1;
            margin-bottom: 8px;
        }
        
        .history-detail {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .history-stock {
            font-size: 16px;
            font-weight: 600;
        }
        
        .history-profit {
            font-size: 16px;
            font-weight: 700;
        }
        
        /* 하단 네비게이션 */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(10, 14, 39, 0.95);
            backdrop-filter: blur(20px);
            border-top: 1px solid rgba(255,255,255,0.1);
            display: flex;
            height: 65px;
            z-index: 1000;
        }
        
        .nav-btn {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 4px;
            background: none;
            border: none;
            color: #8B95A1;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .nav-btn.active {
            color: #00d4ff;
        }
        
        .nav-btn:hover {
            background: rgba(255,255,255,0.05);
        }
        
        .nav-icon {
            font-size: 20px;
        }
        
        /* 모달 */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            z-index: 2000;
            padding: 20px;
            backdrop-filter: blur(10px);
        }
        
        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: #1a1f3a;
            border-radius: 20px;
            padding: 24px;
            width: 100%;
            max-width: 400px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .modal-header {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 20px;
        }
        
        .input-group {
            margin-bottom: 16px;
        }
        
        .input-label {
            font-size: 14px;
            color: #8B95A1;
            margin-bottom: 8px;
        }
        
        input {
            width: 100%;
            padding: 12px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 8px;
            font-size: 16px;
            color: white;
        }
        
        input:focus {
            outline: none;
            border-color: #00d4ff;
            background: rgba(255,255,255,0.08);
        }
        
        .modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .modal-buttons button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
        }
        
        .btn-cancel {
            background: rgba(255,255,255,0.1);
            color: white;
        }
        
        .btn-confirm {
            background: linear-gradient(90deg, #0099ff, #00d4ff);
            color: white;
        }
        
        /* 헤더 버튼 */
        .header-buttons {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            gap: 10px;
        }
        
        .header-btn {
            padding: 8px 16px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            color: white;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .header-btn:hover {
            background: rgba(255,255,255,0.15);
        }
    </style>
</head>
<body>

<!-- 헤더 -->
<div class="header">
    <h1>StockPilot AI</h1>
    <div class="header-buttons">
        <button class="header-btn" onclick="openBuyModal()">매수</button>
        <button class="header-btn" onclick="openSellModal()">매도</button>
    </div>
</div>

<!-- 홈 페이지 -->
<div id="home" class="page active">
    <div class="portfolio-card">
        <div class="portfolio-label">총 자산</div>
        <div class="portfolio-value" id="total-asset">₩0</div>
        <div class="profit-info">
            <span class="profit-amount positive" id="profit-amount">+₩0</span>
            <span class="profit-rate positive" id="profit-rate">+0.00%</span>
            <span style="color: #8B95A1">오늘</span>
        </div>
    </div>
    
    <div class="status-card">
        <div class="status-icon" id="status-icon">✅</div>
        <div class="status-text" id="status-text">포트폴리오 안정</div>
    </div>
    
    <!-- AI 추천 카드들 -->
    <div class="action-grid" id="ai-recommendations">
        <!-- 동적으로 생성됨 -->
    </div>
</div>

<!-- 포트폴리오 페이지 -->
<div id="portfolio" class="page">
    <div class="stock-list" id="stock-list">
        <!-- 종목 카드 동적 생성 -->
    </div>
</div>

<!-- 기록 페이지 -->
<div id="history" class="page">
    <div class="portfolio-card">
        <div class="portfolio-label">누적 수익</div>
        <div class="portfolio-value positive" id="total-profit">+₩0</div>
    </div>
    
    <div id="history-list">
        <!-- 거래 기록 동적 생성 -->
    </div>
</div>

<!-- 하단 네비게이션 -->
<nav class="bottom-nav">
    <button class="nav-btn active" onclick="showPage('home')">
        <span class="nav-icon">🏠</span>
        <span>홈</span>
    </button>
    <button class="nav-btn" onclick="showPage('portfolio')">
        <span class="nav-icon">📊</span>
        <span>포트폴리오</span>
    </button>
    <button class="nav-btn" onclick="showPage('history')">
        <span class="nav-icon">📝</span>
        <span>기록</span>
    </button>
</nav>

<!-- 매수 모달 -->
<div id="buy-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">매수 기록</div>
        <div class="input-group">
            <div class="input-label">종목명</div>
            <input type="text" id="buy-stock-name" placeholder="예: 삼성전자">
        </div>
        <div class="input-group">
            <div class="input-label">수량</div>
            <input type="number" id="buy-quantity" placeholder="예: 10">
        </div>
        <div class="input-group">
            <div class="input-label">매수가</div>
            <input type="number" id="buy-price" placeholder="예: 68500">
        </div>
        <div class="modal-buttons">
            <button class="btn-cancel" onclick="closeBuyModal()">취소</button>
            <button class="btn-confirm" onclick="confirmBuy()">확인</button>
        </div>
    </div>
</div>

<!-- 매도 모달 -->
<div id="sell-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">매도 기록</div>
        <div class="input-group">
            <div class="input-label">종목명</div>
            <input type="text" id="sell-stock-name" placeholder="예: 삼성전자">
        </div>
        <div class="input-group">
            <div class="input-label">수량</div>
            <input type="number" id="sell-quantity" placeholder="예: 5">
        </div>
        <div class="input-group">
            <div class="input-label">매도가</div>
            <input type="number" id="sell-price" placeholder="예: 72000">
        </div>
        <div class="modal-buttons">
            <button class="btn-cancel" onclick="closeSellModal()">취소</button>
            <button class="btn-confirm" onclick="confirmSell()">확인</button>
        </div>
    </div>
</div>

<script>
// 데이터 저장소
let portfolio = JSON.parse(localStorage.getItem('portfolio') || '[]');
let history = JSON.parse(localStorage.getItem('history') || '[]');
let totalAsset = 0;
let totalProfit = 0;

// MCP API 설정 (로컬 개발용)
const API_URL = window.location.hostname === 'localhost' ? 'http://localhost:8001' : '';

// 페이지 전환
function showPage(pageName) {
    // 모든 페이지 숨김
    document.querySelectorAll('.page').forEach(page => {
        page.classList.remove('active');
    });
    
    // 모든 네비 버튼 비활성화
    document.querySelectorAll('.nav-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    
    // 선택된 페이지 표시
    document.getElementById(pageName).classList.add('active');
    
    // 선택된 네비 버튼 활성화
    event.target.closest('.nav-btn').classList.add('active');
    
    // 페이지별 데이터 업데이트
    if (pageName === 'home') {
        updateHome();
    } else if (pageName === 'portfolio') {
        updatePortfolio();
    } else if (pageName === 'history') {
        updateHistory();
    }
}

// 홈 화면 업데이트
function updateHome() {
    // 총자산 계산
    totalAsset = 0;
    totalProfit = 0;
    
    portfolio.forEach(stock => {
        const currentValue = stock.quantity * stock.currentPrice;
        const buyValue = stock.quantity * stock.avgPrice;
        totalAsset += currentValue;
        totalProfit += (currentValue - buyValue);
    });
    
    // 화면 업데이트
    document.getElementById('total-asset').textContent = `₩${totalAsset.toLocaleString()}`;
    document.getElementById('profit-amount').textContent = `${totalProfit >= 0 ? '+' : ''}₩${Math.abs(totalProfit).toLocaleString()}`;
    
    const profitRate = totalAsset > 0 ? (totalProfit / (totalAsset - totalProfit) * 100).toFixed(2) : 0;
    document.getElementById('profit-rate').textContent = `${totalProfit >= 0 ? '+' : ''}${profitRate}%`;
    
    // 색상 변경
    if (totalProfit < 0) {
        document.getElementById('profit-amount').className = 'profit-amount negative';
        document.getElementById('profit-rate').className = 'profit-rate negative';
    }
    
    // AI 추천 카드 생성
    generateAIRecommendations();
}

// AI 추천 카드 생성
function generateAIRecommendations() {
    const container = document.getElementById('ai-recommendations');
    container.innerHTML = '';
    
    // 샘플 AI 추천 (실제로는 MCP API 호출)
    const recommendations = [
        {
            type: 'danger',
            icon: '⚠️',
            title: '삼성전자 매도 시그널',
            stock: '삼성전자',
            currentPrice: '₩68,500',
            recommendation: '₩68,000 이상',
            reason: '단기 고점 도달',
            action: '매도하기'
        },
        {
            type: 'opportunity',
            icon: '🎯',
            title: 'SK하이닉스 매수 찬스',
            stock: 'SK하이닉스',
            currentPrice: '₩125,000',
            recommendation: '₩124,000-125,000',
            reason: '골든크로스 발생',
            action: '매수하기'
        }
    ];
    
    recommendations.forEach(rec => {
        const card = document.createElement('div');
        card.className = `action-card ${rec.type}`;
        card.innerHTML = `
            <div class="action-title">
                ${rec.icon} ${rec.title}
            </div>
            <div class="detail-box">
                <div class="detail-row">
                    <span class="detail-label">현재가</span>
                    <span class="detail-value">${rec.currentPrice}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">추천가</span>
                    <span class="detail-value">${rec.recommendation}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">근거</span>
                    <span class="detail-value">${rec.reason}</span>
                </div>
            </div>
            <button class="action-button">${rec.action} →</button>
        `;
        container.appendChild(card);
    });
    
    // 추천이 없으면 안정 상태
    if (container.children.length === 0) {
        document.getElementById('status-icon').textContent = '✅';
        document.getElementById('status-text').textContent = '포트폴리오 안정';
    } else {
        document.getElementById('status-icon').textContent = '💡';
        document.getElementById('status-text').textContent = 'AI 추천 확인 필요';
    }
}

// 포트폴리오 화면 업데이트
function updatePortfolio() {
    const stockList = document.getElementById('stock-list');
    stockList.innerHTML = '';
    
    portfolio.forEach(stock => {
        const value = stock.quantity * stock.currentPrice;
        const profit = (stock.currentPrice - stock.avgPrice) * stock.quantity;
        const profitRate = ((stock.currentPrice - stock.avgPrice) / stock.avgPrice * 100).toFixed(2);
        
        const card = document.createElement('div');
        card.className = 'stock-card';
        card.innerHTML = `
            <div class="stock-header">
                <div>
                    <div class="stock-name">${stock.name}</div>
                    <div class="stock-quantity">${stock.quantity}주 보유</div>
                </div>
            </div>
            <div class="stock-current">₩${stock.currentPrice.toLocaleString()}</div>
            <div class="stock-profit">
                <span>평가: ₩${value.toLocaleString()}</span>
                <span class="${profit >= 0 ? 'positive' : 'negative'}">
                    ${profit >= 0 ? '+' : ''}${profitRate}%
                </span>
            </div>
        `;
        stockList.appendChild(card);
    });
    
    if (portfolio.length === 0) {
        stockList.innerHTML = '<div style="text-align:center;padding:40px;color:#8B95A1">포트폴리오가 비어있습니다<br>매수 기록을 추가해주세요</div>';
    }
}

// 기록 화면 업데이트
function updateHistory() {
    const historyList = document.getElementById('history-list');
    historyList.innerHTML = '';
    
    // 누적 수익 계산
    let cumulativeProfit = 0;
    history.forEach(record => {
        if (record.type === 'sell') {
            cumulativeProfit += record.profit;
        }
    });
    
    document.getElementById('total-profit').textContent = `${cumulativeProfit >= 0 ? '+' : ''}₩${Math.abs(cumulativeProfit).toLocaleString()}`;
    document.getElementById('total-profit').className = `portfolio-value ${cumulativeProfit >= 0 ? 'positive' : 'negative'}`;
    
    // 최근 거래 표시 (최신순)
    history.slice().reverse().forEach(record => {
        const item = document.createElement('div');
        item.className = 'history-item';
        item.innerHTML = `
            <div class="history-date">${record.date}</div>
            <div class="history-detail">
                <div class="history-stock">${record.stock} ${record.type === 'buy' ? '매수' : '매도'}</div>
                <div class="history-profit ${record.profit >= 0 ? 'positive' : 'negative'}">
                    ${record.type === 'sell' ? (record.profit >= 0 ? '+' : '') + '₩' + Math.abs(record.profit).toLocaleString() : '₩' + record.amount.toLocaleString()}
                </div>
            </div>
        `;
        historyList.appendChild(item);
    });
    
    if (history.length === 0) {
        historyList.innerHTML = '<div style="text-align:center;padding:40px;color:#8B95A1">거래 기록이 없습니다</div>';
    }
}

// 매수 모달
function openBuyModal() {
    document.getElementById('buy-modal').classList.add('show');
}

function closeBuyModal() {
    document.getElementById('buy-modal').classList.remove('show');
    document.getElementById('buy-stock-name').value = '';
    document.getElementById('buy-quantity').value = '';
    document.getElementById('buy-price').value = '';
}

function confirmBuy() {
    const name = document.getElementById('buy-stock-name').value;
    const quantity = parseInt(document.getElementById('buy-quantity').value);
    const price = parseInt(document.getElementById('buy-price').value);
    
    if (!name || !quantity || !price) {
        alert('모든 항목을 입력해주세요');
        return;
    }
    
    // 포트폴리오에 추가 또는 업데이트
    const existingStock = portfolio.find(s => s.name === name);
    if (existingStock) {
        const totalQty = existingStock.quantity + quantity;
        const totalValue = (existingStock.quantity * existingStock.avgPrice) + (quantity * price);
        existingStock.avgPrice = Math.round(totalValue / totalQty);
        existingStock.quantity = totalQty;
    } else {
        portfolio.push({
            name: name,
            quantity: quantity,
            avgPrice: price,
            currentPrice: price
        });
    }
    
    // 기록에 추가
    history.push({
        date: new Date().toLocaleDateString('ko-KR'),
        type: 'buy',
        stock: name,
        quantity: quantity,
        price: price,
        amount: quantity * price,
        profit: 0
    });
    
    // 저장
    localStorage.setItem('portfolio', JSON.stringify(portfolio));
    localStorage.setItem('history', JSON.stringify(history));
    
    closeBuyModal();
    updateHome();
}

// 매도 모달
function openSellModal() {
    document.getElementById('sell-modal').classList.add('show');
}

function closeSellModal() {
    document.getElementById('sell-modal').classList.remove('show');
    document.getElementById('sell-stock-name').value = '';
    document.getElementById('sell-quantity').value = '';
    document.getElementById('sell-price').value = '';
}

function confirmSell() {
    const name = document.getElementById('sell-stock-name').value;
    const quantity = parseInt(document.getElementById('sell-quantity').value);
    const price = parseInt(document.getElementById('sell-price').value);
    
    if (!name || !quantity || !price) {
        alert('모든 항목을 입력해주세요');
        return;
    }
    
    // 포트폴리오에서 차감
    const existingStock = portfolio.find(s => s.name === name);
    if (!existingStock) {
        alert('보유하지 않은 종목입니다');
        return;
    }
    
    if (existingStock.quantity < quantity) {
        alert('보유 수량이 부족합니다');
        return;
    }
    
    // 수익 계산
    const profit = (price - existingStock.avgPrice) * quantity;
    
    // 수량 차감
    existingStock.quantity -= quantity;
    if (existingStock.quantity === 0) {
        portfolio = portfolio.filter(s => s.name !== name);
    }
    
    // 기록에 추가
    history.push({
        date: new Date().toLocaleDateString('ko-KR'),
        type: 'sell',
        stock: name,
        quantity: quantity,
        price: price,
        amount: quantity * price,
        profit: profit
    });
    
    // 저장
    localStorage.setItem('portfolio', JSON.stringify(portfolio));
    localStorage.setItem('history', JSON.stringify(history));
    
    closeSellModal();
    updateHome();
}

// 실시간 가격 업데이트 시뮬레이션
function updatePrices() {
    portfolio.forEach(stock => {
        // 랜덤하게 가격 변동 (-2% ~ +2%)
        const change = (Math.random() - 0.5) * 0.04;
        stock.currentPrice = Math.round(stock.currentPrice * (1 + change));
    });
    
    localStorage.setItem('portfolio', JSON.stringify(portfolio));
    
    // 현재 페이지가 홈이면 업데이트
    if (document.getElementById('home').classList.contains('active')) {
        updateHome();
    }
}

// MCP API 연동 함수 (향후 구현)
async function fetchMCPRecommendations() {
    if (!API_URL) return;
    
    try {
        const response = await fetch(`${API_URL}/api/recommend`);
        const data = await response.json();
        console.log('MCP 추천:', data);
        // 실제 추천 데이터로 AI 카드 업데이트
    } catch (error) {
        console.error('MCP 연결 실패:', error);
    }
}

// 초기화
window.onload = function() {
    updateHome();
    
    // 10초마다 가격 업데이트
    setInterval(updatePrices, 10000);
    
    // 30초마다 AI 추천 업데이트
    setInterval(fetchMCPRecommendations, 30000);
};
</script>

</body>
</html>