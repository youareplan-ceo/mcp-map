name: realtime_profit_signal
description: "ë°±í…ŒìŠ¤íŒ… ê²€ì¦ëœ ì „ëµìœ¼ë¡œ ì‹¤ì‹œê°„ ìˆ˜ìµ ì‹œê·¸ë„ ìƒì„±"

steps:
  # 1. ì¢…ëª© ë¦¬ìŠ¤íŠ¸ ê°€ì ¸ì˜¤ê¸°
  - tool: data_ingest
    action: list
    args:
      limit: 10

  # 2. ê° ì¢…ëª©ë³„ ìµœì  ì „ëµ ì„ íƒ
  - tool: strategy_selector
    action: get_best_strategy
    args:
      symbol: "{{ data_ingest.symbols[0] }}"
      period: "1w"

  # 3. ì‹œì¥ ë°ì´í„° ì¡°íšŒ
  - tool: market
    action: fetch_ohlcv
    args:
      ticker: "{{ data_ingest.symbols[0] }}"
      period: "5d"
      interval: "1h"

  # 4. ê¸°ìˆ  ì§€í‘œ ê³„ì‚°
  - tool: signals
    action: compute_rsi
    args:
      close: "{{ market.close }}"
      period: 14

  # 5. ì „ëµ ì ìš©í•´ì„œ AI ìŠ¤ì½”ì–´ ìƒì„±
  - tool: strategy_selector
    action: apply_strategy
    args:
      symbol: "{{ data_ingest.symbols[0] }}"
      strategy: "{{ strategy_selector.strategy_name }}"

  # 6. ìˆ˜ìµ ê·¹ëŒ€í™” ì—”ì§„ ì ìš© (ê·œì œ íšŒí”¼ ë¬¸êµ¬ ë³€í™˜)
  - agent: profit_maximizer
    task: convert_to_safe_message
    args:
      ai_score: "{{ strategy_selector.ai_score }}"
      signal: "{{ strategy_selector.signal }}"

  # 7. ë²¡í„° DBì— ì €ì¥
  - tool: memvector
    action: upsert
    args:
      doc_id: "signal_{{ data_ingest.symbols[0] }}_{{ timestamp }}"
      text: |
        ì¢…ëª©: {{ data_ingest.symbols[0] }}
        AI ì ìˆ˜: {{ strategy_selector.ai_score }}
        ì‹œê·¸ë„: {{ profit_maximizer.safe_signal }}
        ë©”ì‹œì§€: {{ profit_maximizer.safe_message }}
        ì „ëµ: {{ strategy_selector.strategy_used }}
        ìŠ¹ë¥ : {{ strategy_selector.confidence }}

  # 8. ê²€ì¦ìš© ê¸°ë¡
  - tool: validation_tracker
    action: record
    args:
      symbol: "{{ data_ingest.symbols[0] }}"
      ai_score: "{{ strategy_selector.ai_score }}"
      expected_move: "{{ (strategy_selector.ai_score - 50) / 1000 }}"

  # 9. ì•Œë¦¼ ì „ì†¡ (ê³ ë“ì ë§Œ)
  - condition: "{{ strategy_selector.ai_score > 85 }}"
    agent: notifier
    task: send_alert
    args:
      message: |
        ğŸ¯ ê°•ë ¥ ì‹œê·¸ë„ ê°ì§€
        ì¢…ëª©: {{ data_ingest.symbols[0] }}
        ì ìˆ˜: {{ strategy_selector.ai_score }}/100
        {{ profit_maximizer.safe_message }}
        
        âš ï¸ {{ profit_maximizer.disclaimer }}
