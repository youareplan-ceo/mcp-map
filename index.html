<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>StockPilot AI</title>
<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    background: #F7F8FA;
    padding-bottom: 70px;
    color: #191F28;
}

/* 페이지 */
.page {
    display: none;
    padding: 20px;
    max-width: 480px;
    margin: 0 auto;
    min-height: calc(100vh - 70px);
}

.page.active {
    display: block;
}

/* 헤더 */
.header {
    margin-bottom: 20px;
}

.header h1 {
    font-size: 24px;
    font-weight: 700;
    color: #191F28;
}

.action-buttons {
    display: flex;
    gap: 10px;
    margin-top: 15px;
}

.btn-buy, .btn-sell {
    flex: 1;
    padding: 12px;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
}

.btn-buy {
    background: #4B8BF5;
    color: white;
}

.btn-sell {
    background: #FF5252;
    color: white;
}

/* 자산 카드 */
.asset-card {
    background: white;
    border-radius: 12px;
    padding: 24px;
    text-align: center;
    margin-bottom: 20px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
}

.total-label {
    font-size: 14px;
    color: #8B95A1;
    margin-bottom: 8px;
}

.total-value {
    font-size: 32px;
    font-weight: 700;
    color: #191F28;
    margin-bottom: 12px;
}

.profit-amount {
    font-size: 20px;
    font-weight: 600;
    margin-bottom: 4px;
}

.profit-rate {
    font-size: 16px;
}

.positive {
    color: #00C853;
}

.negative {
    color: #FF5252;
}

/* 상태 카드 */
.status-card {
    background: white;
    border-radius: 12px;
    padding: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
}

.status-icon {
    font-size: 24px;
}

.status-text {
    font-size: 18px;
    font-weight: 600;
    color: #191F28;
}

/* 액션 카드 */
.action-card {
    background: #FFF3F3;
    border: 2px solid #FF5252;
    border-radius: 12px;
    padding: 20px;
    margin-top: 20px;
}

.action-alert {
    font-size: 18px;
    font-weight: 700;
    color: #FF5252;
    text-align: center;
}

/* 종목 카드 */
.stock-list {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.stock-card {
    background: white;
    border-radius: 12px;
    padding: 16px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    cursor: pointer;
}

.stock-header {
    display: flex;
    justify-content: space-between;
    margin-bottom: 12px;
}

.stock-name {
    font-size: 18px;
    font-weight: 700;
}

.stock-qty {
    font-size: 14px;
    color: #8B95A1;
}

.stock-price {
    font-size: 16px;
    font-weight: 600;
    margin-bottom: 8px;
}

.stock-profit {
    display: flex;
    justify-content: space-between;
    font-size: 14px;
}

/* 기록 리스트 */
.summary-card {
    background: white;
    border-radius: 12px;
    padding: 20px;
    text-align: center;
    margin-bottom: 20px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
}

.summary-label {
    font-size: 14px;
    color: #8B95A1;
    margin-bottom: 8px;
}

.summary-value {
    font-size: 28px;
    font-weight: 700;
}

.history-list {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.history-item {
    background: white;
    border-radius: 12px;
    padding: 16px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
}

.history-date {
    font-size: 12px;
    color: #8B95A1;
    margin-bottom: 8px;
}

.history-detail {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.history-stock {
    font-size: 16px;
    font-weight: 600;
}

.history-profit {
    font-size: 16px;
    font-weight: 700;
}

/* 하단 네비게이션 */
.bottom-nav {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: white;
    border-top: 1px solid #E8EBED;
    display: flex;
    height: 70px;
    z-index: 1000;
}

.nav-btn {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 4px;
    background: none;
    border: none;
    color: #8B95A1;
    font-size: 12px;
    cursor: pointer;
}

.nav-btn.active {
    color: #4B8BF5;
}

.nav-btn span:first-child {
    font-size: 20px;
}

/* 모달 */
.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.5);
    z-index: 2000;
    padding: 20px;
}

.modal.show {
    display: flex;
    align-items: center;
    justify-content: center;
}

.modal-content {
    background: white;
    border-radius: 16px;
    padding: 24px;
    width: 100%;
    max-width: 400px;
}

.modal-header {
    font-size: 20px;
    font-weight: 700;
    margin-bottom: 20px;
}

.input-group {
    margin-bottom: 16px;
}

.input-label {
    font-size: 14px;
    color: #8B95A1;
    margin-bottom: 8px;
}

input {
    width: 100%;
    padding: 12px;
    border: 1px solid #E8EBED;
    border-radius: 8px;
    font-size: 16px;
}

.modal-buttons {
    display: flex;
    gap: 10px;
    margin-top: 20px;
}

.modal-buttons button {
    flex: 1;
    padding: 12px;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
}

.btn-cancel {
    background: #E8EBED;
    color: #191F28;
}

.btn-confirm {
    background: #4B8BF5;
    color: white;
}
</style>
</head>
<body>

<!-- 하단 탭 네비게이션 -->
<nav class="bottom-nav">
    <button class="nav-btn active" onclick="showPage('home')">
        <span>🏠</span>
        <span>홈</span>
    </button>
    <button class="nav-btn" onclick="showPage('portfolio')">
        <span>📊</span>
        <span>포트폴리오</span>
    </button>
    <button class="nav-btn" onclick="showPage('history')">
        <span>📝</span>
        <span>기록</span>
    </button>
</nav>

<!-- 홈 페이지 -->
<div id="home" class="page active">
    <div class="header">
        <h1>StockPilot AI</h1>
    </div>
    
    <div class="asset-card">
        <div class="total-label">총자산</div>
        <div class="total-value" id="total-asset">₩0</div>
        <div class="profit-amount positive" id="profit-amount">+₩0</div>
        <div class="profit-rate positive" id="profit-rate">+0.00%</div>
    </div>
    
    <div class="status-card">
        <div class="status-icon" id="status-icon">✅</div>
        <div class="status-text" id="status-text">포트폴리오 안정</div>
    </div>
    
    <!-- 중요 액션 필요시만 표시 -->
    <div id="action-card" class="action-card" style="display:none">
        <div class="action-alert" id="action-text">🔴 AAPL 240불 매도</div>
    </div>
</div>

<!-- 포트폴리오 페이지 -->
<div id="portfolio" class="page">
    <div class="header">
        <h1>포트폴리오</h1>
        <div class="action-buttons">
            <button class="btn-buy" onclick="openBuyModal()">매수 기록</button>
            <button class="btn-sell" onclick="openSellModal()">매도 기록</button>
        </div>
    </div>
    
    <div id="stock-list" class="stock-list">
        <!-- 종목 카드 동적 생성 -->
    </div>
</div>

<!-- 기록 페이지 -->
<div id="history" class="page">
    <div class="header">
        <h1>거래 기록</h1>
    </div>
    
    <div class="summary-card">
        <div class="summary-label">누적 수익</div>
        <div class="summary-value positive" id="total-profit">+₩0</div>
    </div>
    
    <div id="history-list" class="history-list">
        <!-- 거래 기록 동적 생성 -->
    </div>
</div>

<!-- 매수 모달 -->
<div id="buy-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">매수 기록</div>
        <div class="input-group">
            <div class="input-label">종목명</div>
            <input type="text" id="buy-stock-name" placeholder="예: 삼성전자">
        </div>
        <div class="input-group">
            <div class="input-label">수량</div>
            <input type="number" id="buy-quantity" placeholder="예: 10">
        </div>
        <div class="input-group">
            <div class="input-label">매수가</div>
            <input type="number" id="buy-price" placeholder="예: 68500">
        </div>
        <div class="modal-buttons">
            <button class="btn-cancel" onclick="closeBuyModal()">취소</button>
            <button class="btn-confirm" onclick="confirmBuy()">확인</button>
        </div>
    </div>
</div>

<!-- 매도 모달 -->
<div id="sell-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">매도 기록</div>
        <div class="input-group">
            <div class="input-label">종목명</div>
            <input type="text" id="sell-stock-name" placeholder="예: 삼성전자">
        </div>
        <div class="input-group">
            <div class="input-label">수량</div>
            <input type="number" id="sell-quantity" placeholder="예: 5">
        </div>
        <div class="input-group">
            <div class="input-label">매도가</div>
            <input type="number" id="sell-price" placeholder="예: 72000">
        </div>
        <div class="modal-buttons">
            <button class="btn-cancel" onclick="closeSellModal()">취소</button>
            <button class="btn-confirm" onclick="confirmSell()">확인</button>
        </div>
    </div>
</div>

<script>
// 데이터 저장소
let portfolio = JSON.parse(localStorage.getItem('portfolio') || '[]');
let history = JSON.parse(localStorage.getItem('history') || '[]');
let totalAsset = 0;
let totalProfit = 0;

// 페이지 전환
function showPage(pageName) {
    // 모든 페이지 숨김
    document.querySelectorAll('.page').forEach(page => {
        page.classList.remove('active');
    });
    
    // 모든 네비 버튼 비활성화
    document.querySelectorAll('.nav-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    
    // 선택된 페이지 표시
    document.getElementById(pageName).classList.add('active');
    
    // 선택된 네비 버튼 활성화
    event.target.closest('.nav-btn').classList.add('active');
    
    // 페이지별 데이터 업데이트
    if (pageName === 'home') {
        updateHome();
    } else if (pageName === 'portfolio') {
        updatePortfolio();
    } else if (pageName === 'history') {
        updateHistory();
    }
}

// 홈 화면 업데이트
function updateHome() {
    // 총자산 계산
    totalAsset = 0;
    totalProfit = 0;
    
    portfolio.forEach(stock => {
        const currentValue = stock.quantity * stock.currentPrice;
        const buyValue = stock.quantity * stock.avgPrice;
        totalAsset += currentValue;
        totalProfit += (currentValue - buyValue);
    });
    
    // 화면 업데이트
    document.getElementById('total-asset').textContent = `₩${totalAsset.toLocaleString()}`;
    document.getElementById('profit-amount').textContent = `${totalProfit >= 0 ? '+' : ''}₩${Math.abs(totalProfit).toLocaleString()}`;
    
    const profitRate = totalAsset > 0 ? (totalProfit / (totalAsset - totalProfit) * 100).toFixed(2) : 0;
    document.getElementById('profit-rate').textContent = `${totalProfit >= 0 ? '+' : ''}${profitRate}%`;
    
    // 색상 변경
    if (totalProfit < 0) {
        document.getElementById('profit-amount').className = 'profit-amount negative';
        document.getElementById('profit-rate').className = 'profit-rate negative';
    }
    
    // 상태 업데이트 (실제로는 서버에서 받아와야 함)
    // 여기서는 간단한 로직으로 처리
    if (Math.random() > 0.9) {
        document.getElementById('status-icon').textContent = '⚠️';
        document.getElementById('status-text').textContent = '확인 필요';
        document.getElementById('action-card').style.display = 'block';
        document.getElementById('action-text').textContent = '🔴 삼성전자 매도 신호';
    } else {
        document.getElementById('status-icon').textContent = '✅';
        document.getElementById('status-text').textContent = '포트폴리오 안정';
        document.getElementById('action-card').style.display = 'none';
    }
}

// 포트폴리오 화면 업데이트
function updatePortfolio() {
    const stockList = document.getElementById('stock-list');
    stockList.innerHTML = '';
    
    portfolio.forEach(stock => {
        const value = stock.quantity * stock.currentPrice;
        const profit = (stock.currentPrice - stock.avgPrice) * stock.quantity;
        const profitRate = ((stock.currentPrice - stock.avgPrice) / stock.avgPrice * 100).toFixed(2);
        
        const card = document.createElement('div');
        card.className = 'stock-card';
        card.innerHTML = `
            <div class="stock-header">
                <div>
                    <div class="stock-name">${stock.name}</div>
                    <div class="stock-qty">${stock.quantity}주</div>
                </div>
            </div>
            <div class="stock-price">₩${stock.currentPrice.toLocaleString()}</div>
            <div class="stock-profit">
                <span>평가: ₩${value.toLocaleString()}</span>
                <span class="${profit >= 0 ? 'positive' : 'negative'}">
                    ${profit >= 0 ? '+' : ''}${profitRate}%
                </span>
            </div>
        `;
        stockList.appendChild(card);
    });
    
    if (portfolio.length === 0) {
        stockList.innerHTML = '<div style="text-align:center;padding:40px;color:#8B95A1">포트폴리오가 비어있습니다<br>매수 기록을 추가해주세요</div>';
    }
}

// 기록 화면 업데이트
function updateHistory() {
    const historyList = document.getElementById('history-list');
    historyList.innerHTML = '';
    
    // 누적 수익 계산
    let cumulativeProfit = 0;
    history.forEach(record => {
        if (record.type === 'sell') {
            cumulativeProfit += record.profit;
        }
    });
    
    document.getElementById('total-profit').textContent = `${cumulativeProfit >= 0 ? '+' : ''}₩${Math.abs(cumulativeProfit).toLocaleString()}`;
    document.getElementById('total-profit').className = `summary-value ${cumulativeProfit >= 0 ? 'positive' : 'negative'}`;
    
    // 최근 거래 표시 (최신순)
    history.slice().reverse().forEach(record => {
        const item = document.createElement('div');
        item.className = 'history-item';
        item.innerHTML = `
            <div class="history-date">${record.date}</div>
            <div class="history-detail">
                <div class="history-stock">${record.stock} ${record.type === 'buy' ? '매수' : '매도'}</div>
                <div class="history-profit ${record.profit >= 0 ? 'positive' : 'negative'}">
                    ${record.type === 'sell' ? (record.profit >= 0 ? '+' : '') + '₩' + Math.abs(record.profit).toLocaleString() : '₩' + record.amount.toLocaleString()}
                </div>
            </div>
        `;
        historyList.appendChild(item);
    });
    
    if (history.length === 0) {
        historyList.innerHTML = '<div style="text-align:center;padding:40px;color:#8B95A1">거래 기록이 없습니다</div>';
    }
}

// 매수 모달
function openBuyModal() {
    document.getElementById('buy-modal').classList.add('show');
}

function closeBuyModal() {
    document.getElementById('buy-modal').classList.remove('show');
    document.getElementById('buy-stock-name').value = '';
    document.getElementById('buy-quantity').value = '';
    document.getElementById('buy-price').value = '';
}

function confirmBuy() {
    const name = document.getElementById('buy-stock-name').value;
    const quantity = parseInt(document.getElementById('buy-quantity').value);
    const price = parseInt(document.getElementById('buy-price').value);
    
    if (!name || !quantity || !price) {
        alert('모든 항목을 입력해주세요');
        return;
    }
    
    // 포트폴리오에 추가 또는 업데이트
    const existingStock = portfolio.find(s => s.name === name);
    if (existingStock) {
        const totalQty = existingStock.quantity + quantity;
        const totalValue = (existingStock.quantity * existingStock.avgPrice) + (quantity * price);
        existingStock.avgPrice = Math.round(totalValue / totalQty);
        existingStock.quantity = totalQty;
    } else {
        portfolio.push({
            name: name,
            quantity: quantity,
            avgPrice: price,
            currentPrice: price // 실제로는 API에서 가져와야 함
        });
    }
    
    // 기록에 추가
    history.push({
        date: new Date().toLocaleDateString('ko-KR'),
        type: 'buy',
        stock: name,
        quantity: quantity,
        price: price,
        amount: quantity * price,
        profit: 0
    });
    
    // 저장
    localStorage.setItem('portfolio', JSON.stringify(portfolio));
    localStorage.setItem('history', JSON.stringify(history));
    
    closeBuyModal();
    updatePortfolio();
}

// 매도 모달
function openSellModal() {
    document.getElementById('sell-modal').classList.add('show');
}

function closeSellModal() {
    document.getElementById('sell-modal').classList.remove('show');
    document.getElementById('sell-stock-name').value = '';
    document.getElementById('sell-quantity').value = '';
    document.getElementById('sell-price').value = '';
}

function confirmSell() {
    const name = document.getElementById('sell-stock-name').value;
    const quantity = parseInt(document.getElementById('sell-quantity').value);
    const price = parseInt(document.getElementById('sell-price').value);
    
    if (!name || !quantity || !price) {
        alert('모든 항목을 입력해주세요');
        return;
    }
    
    // 포트폴리오에서 차감
    const existingStock = portfolio.find(s => s.name === name);
    if (!existingStock) {
        alert('보유하지 않은 종목입니다');
        return;
    }
    
    if (existingStock.quantity < quantity) {
        alert('보유 수량이 부족합니다');
        return;
    }
    
    // 수익 계산
    const profit = (price - existingStock.avgPrice) * quantity;
    
    // 수량 차감
    existingStock.quantity -= quantity;
    if (existingStock.quantity === 0) {
        portfolio = portfolio.filter(s => s.name !== name);
    }
    
    // 기록에 추가
    history.push({
        date: new Date().toLocaleDateString('ko-KR'),
        type: 'sell',
        stock: name,
        quantity: quantity,
        price: price,
        amount: quantity * price,
        profit: profit
    });
    
    // 저장
    localStorage.setItem('portfolio', JSON.stringify(portfolio));
    localStorage.setItem('history', JSON.stringify(history));
    
    closeSellModal();
    updatePortfolio();
}

// 실시간 가격 업데이트 시뮬레이션
function updatePrices() {
    portfolio.forEach(stock => {
        // 랜덤하게 가격 변동 (-2% ~ +2%)
        const change = (Math.random() - 0.5) * 0.04;
        stock.currentPrice = Math.round(stock.currentPrice * (1 + change));
    });
    
    localStorage.setItem('portfolio', JSON.stringify(portfolio));
    
    // 현재 페이지가 홈이면 업데이트
    if (document.getElementById('home').classList.contains('active')) {
        updateHome();
    }
}

// 초기화
window.onload = function() {
    updateHome();
    
    // 10초마다 가격 업데이트
    setInterval(updatePrices, 10000);
};
</script>

</body>
</html>