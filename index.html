<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>StockPilot AI</title>
<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    background: #F7F8FA;
    padding-bottom: 70px;
    color: #191F28;
}

/* í˜ì´ì§€ */
.page {
    display: none;
    padding: 20px;
    max-width: 480px;
    margin: 0 auto;
    min-height: calc(100vh - 70px);
}

.page.active {
    display: block;
}

/* í—¤ë” */
.header {
    margin-bottom: 20px;
}

.header h1 {
    font-size: 24px;
    font-weight: 700;
    color: #191F28;
}

.action-buttons {
    display: flex;
    gap: 10px;
    margin-top: 15px;
}

.btn-buy, .btn-sell {
    flex: 1;
    padding: 12px;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
}

.btn-buy {
    background: #4B8BF5;
    color: white;
}

.btn-sell {
    background: #FF5252;
    color: white;
}

/* ìì‚° ì¹´ë“œ */
.asset-card {
    background: white;
    border-radius: 12px;
    padding: 24px;
    text-align: center;
    margin-bottom: 20px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
}

.total-label {
    font-size: 14px;
    color: #8B95A1;
    margin-bottom: 8px;
}

.total-value {
    font-size: 32px;
    font-weight: 700;
    color: #191F28;
    margin-bottom: 12px;
}

.profit-amount {
    font-size: 20px;
    font-weight: 600;
    margin-bottom: 4px;
}

.profit-rate {
    font-size: 16px;
}

.positive {
    color: #00C853;
}

.negative {
    color: #FF5252;
}

/* ìƒíƒœ ì¹´ë“œ */
.status-card {
    background: white;
    border-radius: 12px;
    padding: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
}

.status-icon {
    font-size: 24px;
}

.status-text {
    font-size: 18px;
    font-weight: 600;
    color: #191F28;
}

/* ì•¡ì…˜ ì¹´ë“œ */
.action-card {
    background: #FFF3F3;
    border: 2px solid #FF5252;
    border-radius: 12px;
    padding: 20px;
    margin-top: 20px;
}

.action-alert {
    font-size: 18px;
    font-weight: 700;
    color: #FF5252;
    text-align: center;
}

/* ì¢…ëª© ì¹´ë“œ */
.stock-list {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.stock-card {
    background: white;
    border-radius: 12px;
    padding: 16px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    cursor: pointer;
}

.stock-header {
    display: flex;
    justify-content: space-between;
    margin-bottom: 12px;
}

.stock-name {
    font-size: 18px;
    font-weight: 700;
}

.stock-qty {
    font-size: 14px;
    color: #8B95A1;
}

.stock-price {
    font-size: 16px;
    font-weight: 600;
    margin-bottom: 8px;
}

.stock-profit {
    display: flex;
    justify-content: space-between;
    font-size: 14px;
}

/* ê¸°ë¡ ë¦¬ìŠ¤íŠ¸ */
.summary-card {
    background: white;
    border-radius: 12px;
    padding: 20px;
    text-align: center;
    margin-bottom: 20px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
}

.summary-label {
    font-size: 14px;
    color: #8B95A1;
    margin-bottom: 8px;
}

.summary-value {
    font-size: 28px;
    font-weight: 700;
}

.history-list {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.history-item {
    background: white;
    border-radius: 12px;
    padding: 16px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
}

.history-date {
    font-size: 12px;
    color: #8B95A1;
    margin-bottom: 8px;
}

.history-detail {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.history-stock {
    font-size: 16px;
    font-weight: 600;
}

.history-profit {
    font-size: 16px;
    font-weight: 700;
}

/* í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ */
.bottom-nav {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: white;
    border-top: 1px solid #E8EBED;
    display: flex;
    height: 70px;
    z-index: 1000;
}

.nav-btn {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 4px;
    background: none;
    border: none;
    color: #8B95A1;
    font-size: 12px;
    cursor: pointer;
}

.nav-btn.active {
    color: #4B8BF5;
}

.nav-btn span:first-child {
    font-size: 20px;
}

/* ëª¨ë‹¬ */
.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.5);
    z-index: 2000;
    padding: 20px;
}

.modal.show {
    display: flex;
    align-items: center;
    justify-content: center;
}

.modal-content {
    background: white;
    border-radius: 16px;
    padding: 24px;
    width: 100%;
    max-width: 400px;
}

.modal-header {
    font-size: 20px;
    font-weight: 700;
    margin-bottom: 20px;
}

.input-group {
    margin-bottom: 16px;
}

.input-label {
    font-size: 14px;
    color: #8B95A1;
    margin-bottom: 8px;
}

input {
    width: 100%;
    padding: 12px;
    border: 1px solid #E8EBED;
    border-radius: 8px;
    font-size: 16px;
}

.modal-buttons {
    display: flex;
    gap: 10px;
    margin-top: 20px;
}

.modal-buttons button {
    flex: 1;
    padding: 12px;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
}

.btn-cancel {
    background: #E8EBED;
    color: #191F28;
}

.btn-confirm {
    background: #4B8BF5;
    color: white;
}
</style>
</head>
<body>

<!-- í•˜ë‹¨ íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
<nav class="bottom-nav">
    <button class="nav-btn active" onclick="showPage('home')">
        <span>ğŸ </span>
        <span>í™ˆ</span>
    </button>
    <button class="nav-btn" onclick="showPage('portfolio')">
        <span>ğŸ“Š</span>
        <span>í¬íŠ¸í´ë¦¬ì˜¤</span>
    </button>
    <button class="nav-btn" onclick="showPage('history')">
        <span>ğŸ“</span>
        <span>ê¸°ë¡</span>
    </button>
</nav>

<!-- í™ˆ í˜ì´ì§€ -->
<div id="home" class="page active">
    <div class="header">
        <h1>StockPilot AI</h1>
    </div>
    
    <div class="asset-card">
        <div class="total-label">ì´ìì‚°</div>
        <div class="total-value" id="total-asset">â‚©0</div>
        <div class="profit-amount positive" id="profit-amount">+â‚©0</div>
        <div class="profit-rate positive" id="profit-rate">+0.00%</div>
    </div>
    
    <div class="status-card">
        <div class="status-icon" id="status-icon">âœ…</div>
        <div class="status-text" id="status-text">í¬íŠ¸í´ë¦¬ì˜¤ ì•ˆì •</div>
    </div>
    
    <!-- ì¤‘ìš” ì•¡ì…˜ í•„ìš”ì‹œë§Œ í‘œì‹œ -->
    <div id="action-card" class="action-card" style="display:none">
        <div class="action-alert" id="action-text">ğŸ”´ AAPL 240ë¶ˆ ë§¤ë„</div>
    </div>
</div>

<!-- í¬íŠ¸í´ë¦¬ì˜¤ í˜ì´ì§€ -->
<div id="portfolio" class="page">
    <div class="header">
        <h1>í¬íŠ¸í´ë¦¬ì˜¤</h1>
        <div class="action-buttons">
            <button class="btn-buy" onclick="openBuyModal()">ë§¤ìˆ˜ ê¸°ë¡</button>
            <button class="btn-sell" onclick="openSellModal()">ë§¤ë„ ê¸°ë¡</button>
        </div>
    </div>
    
    <div id="stock-list" class="stock-list">
        <!-- ì¢…ëª© ì¹´ë“œ ë™ì  ìƒì„± -->
    </div>
</div>

<!-- ê¸°ë¡ í˜ì´ì§€ -->
<div id="history" class="page">
    <div class="header">
        <h1>ê±°ë˜ ê¸°ë¡</h1>
    </div>
    
    <div class="summary-card">
        <div class="summary-label">ëˆ„ì  ìˆ˜ìµ</div>
        <div class="summary-value positive" id="total-profit">+â‚©0</div>
    </div>
    
    <div id="history-list" class="history-list">
        <!-- ê±°ë˜ ê¸°ë¡ ë™ì  ìƒì„± -->
    </div>
</div>

<!-- ë§¤ìˆ˜ ëª¨ë‹¬ -->
<div id="buy-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">ë§¤ìˆ˜ ê¸°ë¡</div>
        <div class="input-group">
            <div class="input-label">ì¢…ëª©ëª…</div>
            <input type="text" id="buy-stock-name" placeholder="ì˜ˆ: ì‚¼ì„±ì „ì">
        </div>
        <div class="input-group">
            <div class="input-label">ìˆ˜ëŸ‰</div>
            <input type="number" id="buy-quantity" placeholder="ì˜ˆ: 10">
        </div>
        <div class="input-group">
            <div class="input-label">ë§¤ìˆ˜ê°€</div>
            <input type="number" id="buy-price" placeholder="ì˜ˆ: 68500">
        </div>
        <div class="modal-buttons">
            <button class="btn-cancel" onclick="closeBuyModal()">ì·¨ì†Œ</button>
            <button class="btn-confirm" onclick="confirmBuy()">í™•ì¸</button>
        </div>
    </div>
</div>

<!-- ë§¤ë„ ëª¨ë‹¬ -->
<div id="sell-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">ë§¤ë„ ê¸°ë¡</div>
        <div class="input-group">
            <div class="input-label">ì¢…ëª©ëª…</div>
            <input type="text" id="sell-stock-name" placeholder="ì˜ˆ: ì‚¼ì„±ì „ì">
        </div>
        <div class="input-group">
            <div class="input-label">ìˆ˜ëŸ‰</div>
            <input type="number" id="sell-quantity" placeholder="ì˜ˆ: 5">
        </div>
        <div class="input-group">
            <div class="input-label">ë§¤ë„ê°€</div>
            <input type="number" id="sell-price" placeholder="ì˜ˆ: 72000">
        </div>
        <div class="modal-buttons">
            <button class="btn-cancel" onclick="closeSellModal()">ì·¨ì†Œ</button>
            <button class="btn-confirm" onclick="confirmSell()">í™•ì¸</button>
        </div>
    </div>
</div>

<script>
// ë°ì´í„° ì €ì¥ì†Œ
let portfolio = JSON.parse(localStorage.getItem('portfolio') || '[]');
let history = JSON.parse(localStorage.getItem('history') || '[]');
let totalAsset = 0;
let totalProfit = 0;

// í˜ì´ì§€ ì „í™˜
function showPage(pageName) {
    // ëª¨ë“  í˜ì´ì§€ ìˆ¨ê¹€
    document.querySelectorAll('.page').forEach(page => {
        page.classList.remove('active');
    });
    
    // ëª¨ë“  ë„¤ë¹„ ë²„íŠ¼ ë¹„í™œì„±í™”
    document.querySelectorAll('.nav-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    
    // ì„ íƒëœ í˜ì´ì§€ í‘œì‹œ
    document.getElementById(pageName).classList.add('active');
    
    // ì„ íƒëœ ë„¤ë¹„ ë²„íŠ¼ í™œì„±í™”
    event.target.closest('.nav-btn').classList.add('active');
    
    // í˜ì´ì§€ë³„ ë°ì´í„° ì—…ë°ì´íŠ¸
    if (pageName === 'home') {
        updateHome();
    } else if (pageName === 'portfolio') {
        updatePortfolio();
    } else if (pageName === 'history') {
        updateHistory();
    }
}

// í™ˆ í™”ë©´ ì—…ë°ì´íŠ¸
function updateHome() {
    // ì´ìì‚° ê³„ì‚°
    totalAsset = 0;
    totalProfit = 0;
    
    portfolio.forEach(stock => {
        const currentValue = stock.quantity * stock.currentPrice;
        const buyValue = stock.quantity * stock.avgPrice;
        totalAsset += currentValue;
        totalProfit += (currentValue - buyValue);
    });
    
    // í™”ë©´ ì—…ë°ì´íŠ¸
    document.getElementById('total-asset').textContent = `â‚©${totalAsset.toLocaleString()}`;
    document.getElementById('profit-amount').textContent = `${totalProfit >= 0 ? '+' : ''}â‚©${Math.abs(totalProfit).toLocaleString()}`;
    
    const profitRate = totalAsset > 0 ? (totalProfit / (totalAsset - totalProfit) * 100).toFixed(2) : 0;
    document.getElementById('profit-rate').textContent = `${totalProfit >= 0 ? '+' : ''}${profitRate}%`;
    
    // ìƒ‰ìƒ ë³€ê²½
    if (totalProfit < 0) {
        document.getElementById('profit-amount').className = 'profit-amount negative';
        document.getElementById('profit-rate').className = 'profit-rate negative';
    }
    
    // ìƒíƒœ ì—…ë°ì´íŠ¸ (ì‹¤ì œë¡œëŠ” ì„œë²„ì—ì„œ ë°›ì•„ì™€ì•¼ í•¨)
    // ì—¬ê¸°ì„œëŠ” ê°„ë‹¨í•œ ë¡œì§ìœ¼ë¡œ ì²˜ë¦¬
    if (Math.random() > 0.9) {
        document.getElementById('status-icon').textContent = 'âš ï¸';
        document.getElementById('status-text').textContent = 'í™•ì¸ í•„ìš”';
        document.getElementById('action-card').style.display = 'block';
        document.getElementById('action-text').textContent = 'ğŸ”´ ì‚¼ì„±ì „ì ë§¤ë„ ì‹ í˜¸';
    } else {
        document.getElementById('status-icon').textContent = 'âœ…';
        document.getElementById('status-text').textContent = 'í¬íŠ¸í´ë¦¬ì˜¤ ì•ˆì •';
        document.getElementById('action-card').style.display = 'none';
    }
}

// í¬íŠ¸í´ë¦¬ì˜¤ í™”ë©´ ì—…ë°ì´íŠ¸
function updatePortfolio() {
    const stockList = document.getElementById('stock-list');
    stockList.innerHTML = '';
    
    portfolio.forEach(stock => {
        const value = stock.quantity * stock.currentPrice;
        const profit = (stock.currentPrice - stock.avgPrice) * stock.quantity;
        const profitRate = ((stock.currentPrice - stock.avgPrice) / stock.avgPrice * 100).toFixed(2);
        
        const card = document.createElement('div');
        card.className = 'stock-card';
        card.innerHTML = `
            <div class="stock-header">
                <div>
                    <div class="stock-name">${stock.name}</div>
                    <div class="stock-qty">${stock.quantity}ì£¼</div>
                </div>
            </div>
            <div class="stock-price">â‚©${stock.currentPrice.toLocaleString()}</div>
            <div class="stock-profit">
                <span>í‰ê°€: â‚©${value.toLocaleString()}</span>
                <span class="${profit >= 0 ? 'positive' : 'negative'}">
                    ${profit >= 0 ? '+' : ''}${profitRate}%
                </span>
            </div>
        `;
        stockList.appendChild(card);
    });
    
    if (portfolio.length === 0) {
        stockList.innerHTML = '<div style="text-align:center;padding:40px;color:#8B95A1">í¬íŠ¸í´ë¦¬ì˜¤ê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤<br>ë§¤ìˆ˜ ê¸°ë¡ì„ ì¶”ê°€í•´ì£¼ì„¸ìš”</div>';
    }
}

// ê¸°ë¡ í™”ë©´ ì—…ë°ì´íŠ¸
function updateHistory() {
    const historyList = document.getElementById('history-list');
    historyList.innerHTML = '';
    
    // ëˆ„ì  ìˆ˜ìµ ê³„ì‚°
    let cumulativeProfit = 0;
    history.forEach(record => {
        if (record.type === 'sell') {
            cumulativeProfit += record.profit;
        }
    });
    
    document.getElementById('total-profit').textContent = `${cumulativeProfit >= 0 ? '+' : ''}â‚©${Math.abs(cumulativeProfit).toLocaleString()}`;
    document.getElementById('total-profit').className = `summary-value ${cumulativeProfit >= 0 ? 'positive' : 'negative'}`;
    
    // ìµœê·¼ ê±°ë˜ í‘œì‹œ (ìµœì‹ ìˆœ)
    history.slice().reverse().forEach(record => {
        const item = document.createElement('div');
        item.className = 'history-item';
        item.innerHTML = `
            <div class="history-date">${record.date}</div>
            <div class="history-detail">
                <div class="history-stock">${record.stock} ${record.type === 'buy' ? 'ë§¤ìˆ˜' : 'ë§¤ë„'}</div>
                <div class="history-profit ${record.profit >= 0 ? 'positive' : 'negative'}">
                    ${record.type === 'sell' ? (record.profit >= 0 ? '+' : '') + 'â‚©' + Math.abs(record.profit).toLocaleString() : 'â‚©' + record.amount.toLocaleString()}
                </div>
            </div>
        `;
        historyList.appendChild(item);
    });
    
    if (history.length === 0) {
        historyList.innerHTML = '<div style="text-align:center;padding:40px;color:#8B95A1">ê±°ë˜ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤</div>';
    }
}

// ë§¤ìˆ˜ ëª¨ë‹¬
function openBuyModal() {
    document.getElementById('buy-modal').classList.add('show');
}

function closeBuyModal() {
    document.getElementById('buy-modal').classList.remove('show');
    document.getElementById('buy-stock-name').value = '';
    document.getElementById('buy-quantity').value = '';
    document.getElementById('buy-price').value = '';
}

function confirmBuy() {
    const name = document.getElementById('buy-stock-name').value;
    const quantity = parseInt(document.getElementById('buy-quantity').value);
    const price = parseInt(document.getElementById('buy-price').value);
    
    if (!name || !quantity || !price) {
        alert('ëª¨ë“  í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');
        return;
    }
    
    // í¬íŠ¸í´ë¦¬ì˜¤ì— ì¶”ê°€ ë˜ëŠ” ì—…ë°ì´íŠ¸
    const existingStock = portfolio.find(s => s.name === name);
    if (existingStock) {
        const totalQty = existingStock.quantity + quantity;
        const totalValue = (existingStock.quantity * existingStock.avgPrice) + (quantity * price);
        existingStock.avgPrice = Math.round(totalValue / totalQty);
        existingStock.quantity = totalQty;
    } else {
        portfolio.push({
            name: name,
            quantity: quantity,
            avgPrice: price,
            currentPrice: price // ì‹¤ì œë¡œëŠ” APIì—ì„œ ê°€ì ¸ì™€ì•¼ í•¨
        });
    }
    
    // ê¸°ë¡ì— ì¶”ê°€
    history.push({
        date: new Date().toLocaleDateString('ko-KR'),
        type: 'buy',
        stock: name,
        quantity: quantity,
        price: price,
        amount: quantity * price,
        profit: 0
    });
    
    // ì €ì¥
    localStorage.setItem('portfolio', JSON.stringify(portfolio));
    localStorage.setItem('history', JSON.stringify(history));
    
    closeBuyModal();
    updatePortfolio();
}

// ë§¤ë„ ëª¨ë‹¬
function openSellModal() {
    document.getElementById('sell-modal').classList.add('show');
}

function closeSellModal() {
    document.getElementById('sell-modal').classList.remove('show');
    document.getElementById('sell-stock-name').value = '';
    document.getElementById('sell-quantity').value = '';
    document.getElementById('sell-price').value = '';
}

function confirmSell() {
    const name = document.getElementById('sell-stock-name').value;
    const quantity = parseInt(document.getElementById('sell-quantity').value);
    const price = parseInt(document.getElementById('sell-price').value);
    
    if (!name || !quantity || !price) {
        alert('ëª¨ë“  í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');
        return;
    }
    
    // í¬íŠ¸í´ë¦¬ì˜¤ì—ì„œ ì°¨ê°
    const existingStock = portfolio.find(s => s.name === name);
    if (!existingStock) {
        alert('ë³´ìœ í•˜ì§€ ì•Šì€ ì¢…ëª©ì…ë‹ˆë‹¤');
        return;
    }
    
    if (existingStock.quantity < quantity) {
        alert('ë³´ìœ  ìˆ˜ëŸ‰ì´ ë¶€ì¡±í•©ë‹ˆë‹¤');
        return;
    }
    
    // ìˆ˜ìµ ê³„ì‚°
    const profit = (price - existingStock.avgPrice) * quantity;
    
    // ìˆ˜ëŸ‰ ì°¨ê°
    existingStock.quantity -= quantity;
    if (existingStock.quantity === 0) {
        portfolio = portfolio.filter(s => s.name !== name);
    }
    
    // ê¸°ë¡ì— ì¶”ê°€
    history.push({
        date: new Date().toLocaleDateString('ko-KR'),
        type: 'sell',
        stock: name,
        quantity: quantity,
        price: price,
        amount: quantity * price,
        profit: profit
    });
    
    // ì €ì¥
    localStorage.setItem('portfolio', JSON.stringify(portfolio));
    localStorage.setItem('history', JSON.stringify(history));
    
    closeSellModal();
    updatePortfolio();
}

// ì‹¤ì‹œê°„ ê°€ê²© ì—…ë°ì´íŠ¸ ì‹œë®¬ë ˆì´ì…˜
function updatePrices() {
    portfolio.forEach(stock => {
        // ëœë¤í•˜ê²Œ ê°€ê²© ë³€ë™ (-2% ~ +2%)
        const change = (Math.random() - 0.5) * 0.04;
        stock.currentPrice = Math.round(stock.currentPrice * (1 + change));
    });
    
    localStorage.setItem('portfolio', JSON.stringify(portfolio));
    
    // í˜„ì¬ í˜ì´ì§€ê°€ í™ˆì´ë©´ ì—…ë°ì´íŠ¸
    if (document.getElementById('home').classList.contains('active')) {
        updateHome();
    }
}

// ì´ˆê¸°í™”
window.onload = function() {
    updateHome();
    
    // 10ì´ˆë§ˆë‹¤ ê°€ê²© ì—…ë°ì´íŠ¸
    setInterval(updatePrices, 10000);
};
</script>

</body>
</html>